/*
 * Ziqni Application Services
 * Ziqni Application Services are used to manage and configure spaces.
 *
 * The version of the OpenAPI document: 1.0.0
 * Contact: support@ziqni.com
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */


package com.ziqni.admin.sdk.api;

import com.ziqni.admin.sdk.ApiException;
import com.ziqni.admin.sdk.configuration.AdminApiClientConfigBuilder;
import com.ziqni.admin.sdk.data.LoadMembersData;
import com.ziqni.admin.sdk.data.LoadUnitsOfMeasureData;
import com.ziqni.admin.sdk.data.LoadWalletData;
import com.ziqni.admin.sdk.data.LoadWalletTypeData;
import com.ziqni.admin.sdk.model.ModelApiResponse;
import com.ziqni.admin.sdk.util.ApiClientFactoryUtil;
import org.junit.jupiter.api.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.util.ArrayList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

/**
 * API tests for UnitsOfMeasureApi
 */

@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
public class WalletsApiTest implements tests.utils.CompleteableFutureTestWrapper{

    private static final Logger logger = LoggerFactory.getLogger(WalletsApiTest.class);

    private final WalletsApiWs api;

    private final LoadWalletTypeData loadWalletTypeData;
    private final LoadWalletData loadTestData;
    private final LoadMembersData loadMembersData;
    private final LoadUnitsOfMeasureData loadUnitsOfMeasureData;


    private String unitOfMeasureId;
    private String memberId;
    private String walletTypeId;

    private List<String> idsToDelete = new ArrayList<>();
    private List<String> unitOfMeasureIdsToDelete = new ArrayList<>();
    private List<String> memberIdsToDelete = new ArrayList<>();
    private List<String> walletTypesToDelete = new ArrayList<>();


    public WalletsApiTest() throws Exception {
        ApiClientFactoryUtil.initApiClientFactory(AdminApiClientConfigBuilder.build());
        this.api = ApiClientFactoryUtil.factory.getWalletsApi();
        this.loadTestData = new LoadWalletData();
        this.loadWalletTypeData = new LoadWalletTypeData();
        this.loadUnitsOfMeasureData = new LoadUnitsOfMeasureData();
        this.loadMembersData = new LoadMembersData();
    }


    @BeforeAll
    public void setUp() throws ApiException, InterruptedException {
         unitOfMeasureId = loadUnitsOfMeasureData.createTestData(loadUnitsOfMeasureData.
                getCreateRequestAsList(1)).getResults().get(0).getId();

           walletTypeId=loadWalletTypeData.createTestData(List.of(loadWalletTypeData.
                   getCreateRequest(unitOfMeasureId))).getResults().get(0).getId();
         Thread.sleep(5000);
           memberId=loadMembersData.createTestData(List.of(loadMembersData.getCreateRequest()))
                   .getResults().get(0).getId();
        Thread.sleep(5000);
        unitOfMeasureIdsToDelete.add(unitOfMeasureId);
        walletTypesToDelete.add(walletTypeId);
        memberIdsToDelete.add(memberId);
    }

    @AfterAll
    public void cleanUp() throws ApiException {
        try {

            Thread.sleep(5000);

            loadTestData.deleteTestData(idsToDelete);
            loadWalletTypeData.deleteTestData(idsToDelete);
            loadWalletTypeData.deleteTestData(idsToDelete);
            loadUnitsOfMeasureData.deleteTestData(unitOfMeasureIdsToDelete);

        } catch (ApiException | InterruptedException e) {
            logger.error("error", e.getCause());
        }

    }

    @Test
    @Order(1)
    public void createWalletReturnOkTest() throws ApiException {

        final var createRequest = loadTestData.getCreateRequest(memberId,walletTypeId);
        ModelApiResponse response = $(api.createWallets(loadTestData.getCreateRequestAsList(createRequest)));

        assertNotNull(response);
        assertNotNull(response.getResults());
        assertNotNull(response.getErrors());
        assertEquals(1, response.getResults().size(), "Should contain created entity");
        assertNotNull(response.getResults().get(0).getId(), "Created entity should has id");
        logger.info(response.getResults().get(0).getId());
       idsToDelete.add(response.getResults().get(0).getId());
    }

    @Test
    @Order(2)
    public void getWalletSingleIdReturnOkTest() throws ApiException, InterruptedException {
        final var createRequest = loadTestData.getCreateRequest(memberId,walletTypeId);
        var walletTypeId = loadTestData.createTestData(List.of(createRequest)).getResults().get(0).getId();
        Integer limit = 1;
        Integer skip = 0;

        Thread.sleep(5000);

        var response = $(api.getWallets(List.of(walletTypeId), limit, skip));


        assertNotNull(response);
        assertNotNull(response.getResults());
        assertNotNull(response.getErrors());
        assertTrue(response.getErrors().isEmpty(), "Should have no errors");
        assertEquals(limit, response.getResults().size(), "Should has single result");

        var item = response.getResults().get(0);

        idsToDelete.add(item.getId());
    }
    @Test
    @Order(2)
    public void deleteWalletSingleIdReturnOkTest() throws ApiException, InterruptedException {
        final var createRequest = loadTestData.getCreateRequest(memberId,walletTypeId);
        var walletTypeId = loadTestData.createTestData(List.of(createRequest)).getResults().get(0).getId();
        Thread.sleep(10000);
        var response = $(api.deleteWallets(List.of(walletTypeId)));


        assertNotNull(response);

        assertNotNull(response.getErrors());
        assertEquals(1, response.getMeta().getResultCount(), "Results should contain entry");
        assertTrue(response.getErrors().isEmpty(), "Should have no errors");


    }


}
